<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç¾ç”²ç¬”è¯•æµ‹è¯•</title>
    <link rel="stylesheet" href="style.css">
    <script>
        // Enhanced activation check - verify both localStorage AND will verify against Firebase on load
        (function () {
            const code = localStorage.getItem('nail_activation_code');
            const phone = localStorage.getItem('nail_phone');
            const deviceId = localStorage.getItem('nail_device_id');

            // Basic check - must have all three
            if (!code || !phone || !deviceId) {
                window.location.href = 'login.html';
                return;
            }

            // Anti-tampering: check if deviceId format is valid
            if (!deviceId.startsWith('device_') || deviceId.length < 20) {
                localStorage.clear();
                window.location.href = 'login.html';
                return;
            }
        })();
    </script>
</head>

<body>
    <div id="app">
        <header>
            <button id="back-btn" class="back-btn hidden">â† è¿”å›</button>
            <div id="title">ç¾ç”²ç¬”è¯•é¢˜</div>
        </header>

        <!-- Home Screen -->
        <div id="home-screen" class="content"
            style="text-align: center; justify-content: center; display: flex; flex-direction: column;">
            <div class="menu-card">
                <h2>æ¬¢è¿ç»ƒä¹ </h2>
                <p>å…± <span id="total-count">0</span> é“é¢˜</p>
                <button id="start-btn" class="nav-btn primary-btn large-btn">é¡ºåºç»ƒä¹ </button>
                <button id="random-btn" class="nav-btn large-btn"
                    style="margin-top: 10px; background: #87CEEB; color: #333;">ğŸ² éšæœºç»ƒä¹ </button>
            </div>

            <div class="menu-card" style="margin-top: 20px;">
                <h2>é”™é¢˜æœ¬</h2>
                <p>ç´¯è®¡é”™é¢˜: <span id="mistake-count">0</span></p>
                <button id="review-btn" class="nav-btn large-btn">é”™é¢˜å·©å›º</button>
            </div>
        </div>

        <!-- Quiz Section (Hidden initially) -->
        <div id="quiz-section" class="hidden"
            style="display: flex; flex-direction: column; height: 100%; overflow: hidden; flex: 1;">
            <div class="progress-container">
                <div id="progress-bar" class="progress-bar"></div>
            </div>

            <div id="quiz-container" class="content">
                <div id="question-info" style="margin-bottom: 10px; font-weight: bold; color: #666;">
                    Question <span id="current-q">1</span> / <span id="total-q">100</span>
                </div>

                <div id="q-text" class="question-text"
                    style="white-space: pre-wrap; text-align: left; background: #fff; padding: 15px; border-radius: 8px; margin-bottom: 20px; font-size: 1rem; line-height: 1.5;">
                </div>

                <div id="options" class="options-grid">
                    <button class="option-btn" data-value="A">A</button>
                    <button class="option-btn" data-value="B">B</button>
                    <button class="option-btn" data-value="C">C</button>
                    <button class="option-btn" data-value="D">D</button>
                </div>
                <div id="feedback-msg"></div>
            </div>
        </div>

        <!-- Result Section -->
        <div id="result-container" class="content hidden result-screen">
            <h2>æµ‹è¯•ç»“æŸ!</h2>
            <div class="score-display">
                <span id="score">0</span> / <span id="score-total">0</span>
            </div>
            <p>æ„Ÿè°¢æ‚¨çš„å‚ä¸</p>
            <button id="restart-btn" class="nav-btn primary-btn" style="margin-top: 20px;">è¿”å›ä¸»é¡µ</button>
            <br><br>
            <div id="answer-summary" style="text-align: left; width: 100%;">
                <!-- Summary will be injected here -->
            </div>
        </div>

        <footer id="footer-nav" class="hidden">
            <button id="prev-btn" class="nav-btn">ä¸Šä¸€é¢˜</button>
            <button id="next-btn" class="nav-btn primary-btn">ä¸‹ä¸€é¢˜</button>
        </footer>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc, updateDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA5oWHtD3HU04HFRdj6kigbRaNbkkzGdOY",
            authDomain: "nail-b268d.firebaseapp.com",
            projectId: "nail-b268d",
            storageBucket: "nail-b268d.firebasestorage.app",
            messagingSenderId: "724851955894",
            appId: "1:724851955894:web:58d14c6ca65ec57055ae17"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Make Firebase available globally
        window.firebaseDB = db;
        window.firebaseDoc = doc;
        window.firebaseGetDoc = getDoc;
        window.firebaseUpdateDoc = updateDoc;
        window.firebaseSetDoc = setDoc;

        // Signal that Firebase is ready
        window.firebaseReady = true;
        window.dispatchEvent(new Event('firebaseReady'));
    </script>
    <script src="data.js"></script>
    <script src="script.js"></script>
</body>

</html>